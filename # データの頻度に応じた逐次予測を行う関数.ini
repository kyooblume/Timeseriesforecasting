            # ãƒ‡ãƒ¼ã‚¿ã®é »åº¦ã«å¿œã˜ãŸé€æ¬¡äºˆæ¸¬ã‚’è¡Œã†é–¢æ•°
            def sequential_forecast(df, model, selected_variable, freq, future_periods):

                """
                ãƒ‡ãƒ¼ã‚¿ã®é »åº¦ã«å¿œã˜ã¦é€æ¬¡äºˆæ¸¬ã‚’è¡Œã†é–¢æ•°ã€‚
                """
                # é€æ¬¡äºˆæ¸¬ã®æº–å‚™
                y_train_update = y_train.copy()
                X_future = X_train.iloc[-1:].copy()  # æœ€å¾Œã®è¡Œã‚’åŸºã«æœªæ¥ã®ç‰¹å¾´é‡ã‚’æ›´æ–°

                for i in range(future_periods):

                    # ç‰¹å¾´é‡ã®æ•´åˆæ€§ã‚’ç¢ºä¿
                    X_future = align_features(X_train, X_future)

                    # äºˆæ¸¬
                    y_pred = model.predict(X_future)
                    y_pred_series = pd.Series(y_pred, index=[X_future.index[0] + i + 1])
                    y_train_update = pd.concat([y_train_update, y_pred_series])

                    # ç‰¹å¾´é‡ã‚’æ›´æ–°
                    if freq == "D":
                        X_future["lag_1"] = y_train_update.iloc[-1]
                        X_future["lag_7"] = y_train_update.iloc[-7:].mean()
                        X_future["ma_7"] = y_train_update.iloc[-7:].mean()
                        X_future["ma_30"] = y_train_update.iloc[-30:].mean()
                    elif freq == "M":
                        X_future["lag_1"] = y_train_update.iloc[-1]
                        X_future["lag_3"] = y_train_update.iloc[-3:].mean()
                        X_future["lag_6"] = y_train_update.iloc[-6:].mean()
                        X_future["lag_12"] = y_train_update.iloc[-12:].mean()
                        X_future["ma_3"] = y_train_update.iloc[-3:].mean()
                        X_future["ma_6"] = y_train_update.iloc[-6:].mean()
                        X_future["ma_12"] = y_train_update.iloc[-12:].mean()
                    elif freq == "Y":
                        X_future["lag_1"] = y_train_update.iloc[-1]
                        X_future["lag_2"] = y_train_update.iloc[-2:].mean()
                        X_future["lag_5"] = y_train_update.iloc[-5:].mean()
                        X_future["lag_10"] = y_train_update.iloc[-10:].mean()
                        X_future["ma_2"] = y_train_update.iloc[-2:].mean()
                        X_future["ma_5"] = y_train_update.iloc[-5:].mean()
                        X_future["ma_10"] = y_train_update.iloc[-10:].mean()

                return y_train_update[-future_periods:]

            # é€æ¬¡äºˆæ¸¬ã‚’å®Ÿè¡Œ
            forecast = sequential_forecast(df, model, selected_variable="cancel_user", freq=freq, future_periods=future_periods)

            # äºˆæ¸¬çµæœã‚’å–å¾—
            future_dates = pd.date_range(start=df_test["yyyymmdd"].max() + pd.DateOffset(days=1), periods=future_periods, freq=freq)
            future_pred = forecast.values
            # future_dates ã«åŸºã¥ã future_df ã‚’ä½œæˆ
            future_df = pd.DataFrame({
            "yyyymmdd": future_dates
        })
            # æœªæ¥ã® DataFrame ã‚’ä½œæˆ
            future_df = pd.DataFrame({"yyyymmdd": pd.to_datetime(future_dates)})
            #    ç‰¹å¾´é‡ä½œæˆã¨å‰å‡¦ç†
            future_df = preprocess_features(create_time_features(future_df, selected_variable, freq))


            # ç‰¹å¾´é‡ã®æ•´åˆæ€§ã‚’ç¢ºä¿
            future_df = align_features(X_train, future_df)

            # æœªæ¥äºˆæ¸¬
            future_pred = model.predict(future_df)

            # äºˆæ¸¬çµæœã‚’è¡¨ç¤º
            st.subheader("ğŸ“ˆ äºˆæ¸¬çµæœ")
            st.write(pd.DataFrame({"yyyymmdd": future_dates, "Predicted": future_pred}))

            # ã‚°ãƒ©ãƒ•ã®æç”»
            fig, ax = plt.subplots(figsize=(12, 6))
            ax.plot(future_dates, future_pred, label="Forecast", marker="x")
            plt.xticks(rotation=45)
            plt.legend()
            st.pyplot(fig)
